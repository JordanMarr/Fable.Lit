<html class="has-navbar-fixed-top"><head><title>Fable.Lit Â· Hot Reloading</title><meta http-equiv="content-type"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/Fable.Lit/style.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"/></head><body><nav class="navbar is-fixed-top"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/Fable.Lit/">Fable.Lit</a><a class="navbar-item is-hidden-desktop" href="https://github.com/fable-compiler/Fable.Lit"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item is-hidden-desktop" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-burger" data-target="nav-menu"><span></span><span></span><span></span></a></div><div class="navbar-menu" id="nav-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/Fable.Lit/docs/getting-started.html">Documentation</a></div><div class="navbar-end"><a class="navbar-item" href="https://github.com/fable-compiler/Fable.Lit"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a></div></div></div></nav><div class="container"><div class="mobile-menu"><nav class="breadcrumb"><ul><li><a class="menu-trigger"><span></span><span></span><span></span></a></li><li class="is-active"><a>Hot Reloading</a></li></ul></nav></div><div class="columns is-gapless is-mobile"><div class="column is-menu-column is-3-desktop is-hidden-touch ml-5"><div class="menu-container"><aside class="menu"><ul class="menu-list"><li><a class=" " href="/Fable.Lit/docs/getting-started.html">Getting started</a></li><li><a class=" " href="/Fable.Lit/docs/templates.html">Templates</a></li><li><a class=" " href="/Fable.Lit/docs/hook-components.html">Hook Components</a></li><li><a class=" " href="/Fable.Lit/docs/web-components.html">Web Components</a></li><li><a class=" is-active has-table-of-content" href="/Fable.Lit/docs/hmr.html">Hot Reloading</a></li><ul class="table-of-content"><li><a href="#Webpack" data-toc-element="true">Webpack </a></li><li><a href="#Vite" data-toc-element="true">Vite </a><ul class="table-of-content"><li><a href="#Fable-runFast" data-toc-element="true">Fable --runFast </a></li></ul></li><li><a href="#Non-bundling-HMR" data-toc-element="true">Non-bundling HMR </a></li></ul><li><a class=" " href="/Fable.Lit/docs/testing.html">Testing</a></li></ul></aside></div></div><div class="column is-8-desktop is-full-touch"><section class="section"><div class="content"><header class="page-header"><a class="button is-hidden-touch is-outlined is-primary is-pulled-right" target="_blank" href="https://github.com/fable-compiler/Fable.Lit/edit/main/docsrc/docs\hmr.md">Edit</a><h1 class="title is-1">Hot Reloading</h1></header><div><h2>Webpack <a href="#Webpack" aria-hidden="true"><span class="anchor" id="Webpack"></span>#</a></h2>
<p>Webpack has been the standard to build frontend apps for a while, and it's also widely used in Fable apps. Webpack is extremely reliable and extensible, and it's still a great choice for your web app.</p>
<p>It has a couple of disadvantages however: usually requires a configuration file that can get complicated very quickly and its development server bundles your whole app for every change, which can take a few seconds in large projects.</p>
<h2>Vite <a href="#Vite" aria-hidden="true"><span class="anchor" id="Vite"></span>#</a></h2>
<p>A new generation of JS tooling is appearing which follow best practices by default so they require little to no configuration. Moreover, these tools include a development server that doesn't bundle your application, which makes updated much faster as the browser only need to load the modules that have changed. The most prominent examples are <a href="https://vitejs.dev">Vite</a> and <a href="https://www.snowpack.dev/">Snowpack</a>.</p>
<p>We've personally got great results with Vite. It is somewhat opinionated and thanks to this you can get a development server and build tool with zero-config by conforming to a few defaults:</p>
<ul>
<li>Put your static files in the <code>public</code> folder</li>
<li>Put your <code>index.html</code> in the app root (usually next to <code>package.json</code>)</li>
<li>Add a reference to the entry JS file (relative path is important):</li>
</ul>
<pre class="skip-code-lightner-grammar-not-found" ><code class="language-html">&lt;script type=&quot;module&quot; src=&quot;./build/client/App.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>With this you only need to install Vite and run the commands for starting the development server or bundling for production as needed.</p>
<pre><code>npm i -D vite
npx vite --open     # Start dev server and open browser
npx vite build      # Build your site for production
</code></pre>
<p>That's it, now you have an extremely fast development server and an optimized build with zero config (built files will be put in <code>dist</code> folder by default). If you need to edit some settings, you can still use a <a href="https://vitejs.dev/config/">config file</a> or the CLI options (check them with <code>npx vite --help</code>).</p>
<h3>Fable --runFast <a href="#Fable-runFast" aria-hidden="true"><span class="anchor" id="Fable-runFast"></span>#</a></h3>
<p>If you use <code>--runFast</code> option with Fable instead of <code>--run</code>, Vite will be started right away instead of waiting until first Fable compilation. When developing you usually already have the compiled files from the previous day, so this way you can get a development server up and running in under 200 milliseconds!</p>
<pre><code>dotnet fable watch src -o build/client --runFast vite --open
</code></pre>
<blockquote>
<p>When Fable compilation finishes Vite will just reload with the updated code.</p>
</blockquote>
<p>For production make sure to use <code>--run</code> so vite doesn't start bundling until Fable has finished compilation.</p>
<pre><code>dotnet fable src -o build/client --run vite build
</code></pre>
<h2>Non-bundling HMR <a href="#Non-bundling-HMR" aria-hidden="true"><span class="anchor" id="Non-bundling-HMR"></span>#</a></h2>
<p>Lit.Elmish.HMR works with non-bundling development servers like Vite or Snowpack, but with a important caveat. These dev servers do &quot;true&quot; Hot-Module-Replacement in the sense they only replace the updated module (remember in JS &quot;modules&quot; is roughly the same as &quot;file&quot;). However, in Elmish apps the function that triggers rendering <code>Program.run</code> is usually located in the last file. When updating any other file, the render function won't be triggered and you won't see anything changing on screen.</p>
<p>Solving this for Vite and Snowpack requires injecting special code in each module containing a component. This is usually done by plugins like <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-react">React Fast Refresh</a>. Indeed you can already get a hyper-fast hot reloading experience out-of-the-box with Vite/Snowpack thanks to <a href="https://zaid-ajaj.github.io/Feliz/#/Feliz/React/StatelessComponents">Feliz ReactComponent</a>. At the time of writing, there is no such a plugin for Lit, instead Fable.Lit provides code helpers for <a href="./hook-components.html">HookComponents</a> so you can control HMR at the component level.</p>
<article class="message is-info">
                    <div class="message-body"><p>At the time of writing HMR is <strong>only available for HookComponents</strong> not for web components declared with <code>LitElement</code>.</p>
</div>
</article>
<p>First thing you need to do is to instantiate a private <em>HMR token</em> at the top of the file containing your HookComponents:</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">open</span><span> </span><span style="color: #4078F2">Lit</span>

<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">hmr</span><span> </span><span style="color: #A626A4">=</span><span> HMR.createToken</span><span style="color: #986801">()</span></code></pre>
<p>One important thing to remember though, is that HMR in non-bundling dev servers doesn't just update the whole module (this wouldn't have any effect because other modules would still reference the old exports). In the case of Fable.Lit it will just update the render function of the HookComponents, so in order to avoid breaking dependent modules it's a good idea to put internal helpers (together with the HMR token) within a private inner module, and only expose the HookComponents.</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">module</span><span style="color: #4078F2"> </span><span style="color: #A626A4">private</span><span style="color: #4078F2"> Util </span><span style="color: #A626A4">=</span>
<span>    </span><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">hmr</span><span> </span><span style="color: #A626A4">=</span><span> HMR.createToken</span><span style="color: #986801">()</span>
<span>    </span><span style="color: #A0A1A7;font-style: italic">// Other utilities here</span>

<span style="color: #A626A4">open</span><span> </span><span style="color: #4078F2">Util</span>

<span style="color: #0184BC">[&lt;HookComponent&gt;]</span>
<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">MyComponent</span><span style="color: #986801">()</span><span> </span><span style="color: #A626A4">=</span><span> </span><span style="color: #A626A4">..</span></code></pre>
<article class="message is-info">
                    <div class="message-body"><p>This limitation is the same as with React Fast Refresh. The main difference is with Fable.Lit you can have multiple HookComponents in the same file.</p>
</div>
</article>
<p>Now the only thing left is to pass the HMR token to the HookComponents, this has to be done for each component you want to enable HMR for, and can be done with the <code>useHmr</code> hook.</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #0184BC">[&lt;HookComponent&gt;]</span>
<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">MyComponent</span><span style="color: #986801">()</span><span> </span><span style="color: #A626A4">=</span>
<span>    Hook.useHmr</span><span style="color: #A626A4">(</span><span>hmr</span><span style="color: #A626A4">)</span>
<span>    </span><span style="color: #A626A4">..</span></code></pre>
<p>This is a bit of a set up but it will enable a blazing fast feedback loop that is extremely valuable when you're making small UI adjustments. Also, when compiling in Release mode the HMR helpers will automatically be removed, so you don't need to worry about disabling them manually.</p>
<hr />
<p>If for some reason you are getting unexpected behavior with HMR, you can disable it and force a full refresh by passing <code>false</code> when creating the HMR token in a specific module.</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">hmr</span><span> </span><span style="color: #A626A4">=</span><span> HMR.createToken</span><span style="color: #A626A4">(</span><span style="color: #986801">false</span><span style="color: #A626A4">)</span></code></pre>
<blockquote>
<p>After passing false, you need to save <strong>twice</strong> before the full refresh kicks in.</p>
</blockquote>
</div></div></section><div class="navigation-container"><a class="button navigate-to-previous is-primary is-outlined" href="/Fable.Lit/docs/web-components.html"><span class="icon"><i class=" fas fa-arrow-left"></i></span><span class=" is-uppercase">Web Components</span></a><br class="is-hidden-tablet"/><a class="button navigate-to-next is-primary is-outlined" href="/Fable.Lit/docs/testing.html"><span class=" is-uppercase">Testing</span><span class="icon"><i class=" fas fa-arrow-right"></i></span></a></div></div></div></div><script async="" src="/Fable.Lit/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>